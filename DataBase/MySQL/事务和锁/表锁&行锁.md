## 行锁

InnoDB 实现了以下两种类型的**行锁**：

- 共享锁（S）：允许一个事务去读一行，阻止其他事务获得相同数据集的排他锁。
- 排他锁（X）：允许获得排他锁的事务更新数据，阻止其他事务取得相同数据集的共享读锁和排他写锁。

## 锁的分类

### 行锁
锁定一行数据，即上面所说的共享锁和排他锁
### 间隙锁
锁定一个范围，但不包含记录本身。例如数据库中数据id为3，8，11，那么锁定的区间可能为（-∞,3），(3,8)(8,11)，(11,+∞)，假如插入的数据为6，那此时锁定的区间为(3,6)，(6,8)被锁定，不包括要插入的6.
### 行锁 + 间隙锁
锁定一个范围，包括记录本身，例如数据库中数据id为3，8，11，那么锁定的区间可能为（-∞,3]，(3,8](8,11]，(11,+∞]，假如插入的数据为6，此时锁定的区间(3,8]变为(3,6]，(6,8]两个部分，可以看到，6也被锁定。

## 锁的应用

insert 插入记录时，需要获取行锁

update 更新一条记录时，如果记录存在，需要行锁；如果记录不存在，行锁 + 间隙锁

delete 删除一条记录时，如果记录存在，需要行锁；如果记录不存在，行锁 + 间隙锁

select 查询记录时，不会存在锁，除非显示的调用lock in share mode或者for update，如下所示。为什么查询不存在锁呢？因为InnoDB引擎select查询返回的是数据的快照版本，这也是为什么在许多mysql书中，事务的select查询需要锁时，要显示的使用加锁语法。参见MySQL查询不需要锁，了解更多有关InnoDB查询的机制。
