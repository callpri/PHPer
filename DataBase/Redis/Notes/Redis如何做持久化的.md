### Redis如何做持久化的？

bgsave做镜像全量持久化，aof做增量持久化。因为bgsave会耗费较长时间，不够实时，在停机的时候会导致大量丢失数据，所以需要aof来配合使用。

内存快照以一定的频率执行，在两次快照之间，使用 AOF 日志记录这期间的所有命令操作

## RDB快照：全量

1. Save: 在主线程中执行，会导致阻塞
2. bgsave:在后台异步(Asynchronously)保存当前数据库的数据到磁盘。

![img](assets/4dc5fb99a1c94f70957cce1ffef419cc.jpg)

## AOF（Append Only File：增量

####概念

AOF: 以协议文本的方式，将所有对数据库进行过写入的命令（及其参数）记录到 AOF 文件，以此达到记录数据库状态的目的。

#### 优点

命令执行后才记录日志，不会阻塞当前的写操作

#### 问题

刚执行玩之后，没有记成功就宕机了，会丢失数据

AOF可能会阻塞下一次操作

#### 写回策略

![img](assets/72f547f18dbac788c7d11yy167d7ebf8.jpg)

## 

### Redis的同步机制了解么？

Redis可以使用主从同步，从从同步。第一次同步时，主节点做一次bgsave，并同时将后续修改操作记录到内存buffer，待完成后将rdb文件全量同步到复制节点，复制节点接受完成后将rdb镜像加载到内存。加载完成后，再通知主节点将期间修改的操作记录同步到复制节点进行重放就完成了同步过程。